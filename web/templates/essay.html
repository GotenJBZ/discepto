{{ define "essay" }} {{ template "head" . }}
</head>
<style>
    .tabs {
    overflow: visible;
        overflow-x: visible;
        overflow-y: visible;
    overflow-x: visible;
}
</style>
<body class="body">
    {{ template "navbar" .}}
    <br>
    <div class="container is-max-widescreen">
        <div class="columns  mr-2 ml-2">
            <div class="column is-8 is-narrow">

                <div class="box">
                        
                            <div class="media">
                                <div class="media-left">
                                    <figure class="image is-64x64">
                                        <p>
                                            <img class="is-rounded " src="https://bulma.io/images/placeholders/128x128.png ">
                                        </p>
                                    </figure>
                                </div>
                                <div class="media-content">
                                    <p class="title is-5">
                                        {{.Essay.Thesis}}  
                                        
                                    </p>
                                    <p class="subtitle is-6">
                                        <a href="#">{{.Essay.AttributedToName}}</a>&nbsp; <time datetime="2018-1-1">{{ .Essay.Published }}</time>
                                    </p>
                                    
                                </div>
                                <div class="media-right is-hidden-mobile">
                                    {{if eq .Essay.ReplyType.String "supports" }}
                                    <span class="tag is-success is-light is-medium">Supports</span> {{ else if eq .Essay.ReplyType.String "refutes"}}
                                    <span class="tag is-danger is-light is-medium">Refutes</span> {{ else }}
                                    <span class="tag is-warning is-light is-medium">General</span> {{ end }}

                                    <div id="essay-dropdown" class="dropdown">
                                        <div class="dropdown-trigger">
                                            <button class="button is-white" aria-haspopup="true" aria-controls="dropdown-menu">
                                                <span class="icon is-small">
                                                    <i class="fa fa-ellipsis-v"></i>
                                                </span>
                                            </button>
                                        </div>
                                        <div class="dropdown-menu" id="dropdown-menu">
                                            <div class="dropdown-content is-small">
                                                <a href="#" hx-post="/s/{{ .Essay.PostedIn }}/{{.Essay.ID}}/report" class="dropdown-item has-text-danger">Report</a>
                                                {{ if .Perms.DeleteEssay }}
                                                <a href="#" hx-delete="/s/{{ .Essay.PostedIn }}/{{.Essay.ID}}" class="dropdown-item has-text-danger">Delete</a>
                                                {{ end }}
                                            </div>
                                        </div>
                                    </div>
        
        
                                    <script>
                                        var dropdown = document.querySelector('#essay-dropdown');
                                        dropdown.addEventListener('click', function(event) {
                                            event.stopPropagation();
                                            dropdown.classList.toggle('is-active');
                                        });
                                    </script>
                                </div>
                                
                            </div>
                            <br>
                            <div class="media-content">
                                <div class="content">
                                    <p>
                                        {{.Essay.Content | markdown}}
                                    </p>
                                </div>
                            </div>
                            <nav class="level is-mobile">
                                <div class="level-left ">

                                    <div class="buttons" id="essay-btns">
                                        <button class="button mr-3 is-white">
                                            <span class="icon is-small has-text-danger">
                                                <i class="fa fa-heart " aria-hidden="true"></i>
                                            </span>
                                        </button>
                                        <button hx-post="/s/{{.Essay.PostedIn}}/{{.Essay.ID}}/vote" hx-vals='{"vote": "upvote"}' hx-target="#essay-btns" hx-select="#essay-btns" hx-swap="outerHTML" class="button mr-3 is-white">
                                            <span class="icon is-small">
                                                <i class="fa fa-arrow-up {{ if eq .EssayUserDid.Vote.String "upvote" }} has-text-primary {{ end }} " aria-hidden="true"></i>
                                                <p class="has-text-black">&nbsp;{{ .Essay.Upvotes }}</p>
                                            </span>
                                        </button>
                                        <button hx-post="/s/{{.Essay.PostedIn}}/{{.Essay.ID}}/vote" hx-vals='{"vote": "downvote"}' hx-target="#essay-btns" hx-select="#essay-btns" hx-swap="outerHTML" class="button mr-3 is-white">
                                            <span class="icon is-small">
                                                <i class="fa fa-arrow-down {{ if eq .EssayUserDid.Vote.String "downvote" }} has-text-primary {{ end }}" aria-hidden="true"></i>
                                                <p class="has-text-black">&nbsp;{{ .Essay.Downvotes }}</p>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </nav>
                        
                </div>


                <section id="replies">
                    <h1 class="title is-2 ">Replies</h1>
                    <div class="tabs">
                        <ul class="tabs-menu" hx-indicator="#replies" hx-boost="true" hx-swap="outerHTML" hx-target="#replies" hx-select="#replies">
                            <li class="{{if eq .FilterReplyType "general"}}is-active{{end}}"><a href="?replyType=general">Generals</a></li>
                            <li class="{{if eq .FilterReplyType "refutes"}}is-active{{end}}"><a href="?replyType=refutes">Refutes</a></li>
                            <li class="{{if eq .FilterReplyType "supports"}}is-active{{end}}"><a href="?replyType=supports">Supports</a></li>
                        </ul>
                        <span id="tab-loader" style="right: 20px; left: auto" class="is-overlay icon is-medium htmx-indicator loader"></span>
                    </div>

                    <div class="box block" id="newessay-btn">
                        <article class="media">
                            <figure class="media-left">
                                <p class="image is-64x64">
                                    <img class="is-rounded" src="https://bulma.io/images/placeholders/128x128.png">
                                </p>
                            </figure>
                            <div class="media-content">
                                <div class="content">
                                    <p class="title is-7"></p>
                                    <a href="/newessay?inReplyTo={{ .Essay.ID }}&subdiscepto={{ .Essay.PostedIn }}">
                                        <input class="input is-primary" type="text" placeholder="Write an essay">
                                    </a>
                                </div>

                            </div>
                        </article>
                    </div>
                    <div class="tab-content dis-htmx-fade-in">
                        {{ range .Replies }}
                        {{ template "essayCard" . }} 
                        {{ end }}
                    </div>

                </section>
            </div>




            <div class="column is-4 is-fluid">
                
                <div class="card ">
                    <nav class="panel is-primary ">
                        <p class="panel-heading ">Sources</p>
                        {{ $length := len .Sources }} {{ if eq $length 0 }}
                        <a class="panel-block ">The user didn't provide the fonts</a> {{ else }} {{ range .Sources }}
                        <a class="panel-block ">{{ . }}</a> {{ end }} {{end}}
                    </nav>
                </div>

                <br> {{ template "subdisceptoCard" .Subdiscepto }}

                <div class="card">
                    <nav class="panel is-primary">
                        <p class="panel-heading ">Your Communities</p>
                        {{ $length := len .SubdisceptoList }} {{ if eq $length 0 }}
                        <a href="/s" class="panel-block ">join in a comunity</a> {{ else }} {{ range .SubdisceptoList }}
                        <a href="/s/{{ . }} " class="panel-block ">s/{{ . }}</a> {{ end }} {{end}}
                    </nav>
                </div>
                <br> 
                <div class="box is-relative is-flex-grow-1 is-flex is-flex-direction-column">
                <div class="field is-grouped">
                    <figure class="image is-48x48">
                        <img class="is-rounded" src="https://bulma.io/images/placeholders/48x48.png">
                    </figure>
                    <div class="field pl-5">
                        <p class="title is-4"><a href="">{{.Essay.AttributedToName}}</a></p>
                        <p class="subtitle is-6">Followers: 20k</p>
                    </div>
                </div>
                <p class="block is-flex-grow-1">Bio Lorem ipsum dolor sit amet consectetur, adipisicing elit. Obcaecati commodi similique asperiores incidunt reprehenderit molestias ea natus corporis. Maxime fugit possimus obcaecati cumque explicabo ipsum aspernatur recusandae ratione voluptates exercitationem?</p>
                <div class="field is-grouped">
                    <div class="control is-expanded">          
                        <button class="button is-primary is-outlined is-fullwidth is-rounded">follow</button> 
                        
                    </div>  
                    
                </div>
            </div>
            </div>

            {{ template "footer" }} {{ end }}
