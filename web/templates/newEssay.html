{{ define "newEssay" }} {{ template "head" . }}
</head>

<body class="body">
    {{ template "navbar" }}
    <div class="section">
        <div class="container is-max-widescreen">
            <h1 class="title is-1">Write a new essay</h1>
            <div class="box">
                <form action="/newessay" method="post" enctype="multipart/form-data" id='formid'>
                <div class="field">
                    <label class="label">Title</label>
                    <div class="control has-icons-left">
                        <input type="text" placeholder="Title of your discepto" class="input is-primary" name="thesis" id="thesis" required>
                        <span class="icon is-small is-left">
                            <i class="fa fa-home"></i>
                        </span>
                    </div>
                </div>

                <div class="field">
                    {{ if or (.InReplyTo.Valid) (not (eq .PostedIn "")) }}
                    <input value="{{ .PostedIn }}" name="postedIn" type="hidden"> {{ else }}
                    <label class="label">Community</label>
                    <div class="select is-primary">
                        <select name="postedIn">
                            {{ range .MySubdisceptos }}
                            <option value="{{ .Name }}">{{ .Name }}</option>
                            {{ end }}
                        </select></div> {{ end }}
                </div>

                {{ if .InReplyTo.Valid }}

                <div class="field">
                    <input type="hidden" class="input is-primary" name="inReplyTo" value="{{.InReplyTo.Int32}}">
                    <label class="label">Reply type</label>


                    <div class="control">
                        <label class="radio">
                            <input type="radio" name="replyType" value="supports" checked> 
                            <span class="tag is-success is-light is-medium">Supports</span>
                        </label>
                        <label class="radio">
                            <input type="radio" name="replyType" value="refutes">
                            <span class="tag is-danger is-light is-medium">Refutes</span>
                        </label>
                        <label class="radio">
                            <input type="radio" name="replyType" value="general">
                            <span class="tag is-warning is-light is-medium">General</span>
                        </label>
                    </div>
                </div>

                {{ end }}


                


                <div class="field">
                    <label class="label">Text</label>
                    <textarea class="simplemde" id="content" name="content">
First paragraph introducing the essay. This will be shown as a preview of the essay.
Maximum length of 300 chars.

## First argumentation
...

## Second argumentation
...
                    </textarea>
                </div>

                <div class="field">
                    <label class="label">Tags</label>
                    <div class="control">
                        <input type="text" placeholder="Insert tags" class="input is-primary" required name="tags">
                    </div>
                    <p class="help">Insert tags separated by commas e.g. tags1,tags2,tags3</p>
                </div>
                <div class="field is-hidden" id="1-q">
                    <div class="field">
                        <label class="label">First Question</label>
                        <div class="control">
                            <input type="text" placeholder="Insert the first question" class="input is-primary" name="1-question">
                        </div>
                        <p class="help">The first answer is the right one</p>
                    </div>

                    <div class="field is-horizontal">
                        <div class="field-body">
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="First answer" name="1-1-answer">
                                </p>
                            </div>
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="Second answer" name="1-2-answer">
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="field is-horizontal">
                        <div class="field-body">
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="Third answer" name="1-3-answer">
                                </p>
                            </div>
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="Fourth answer" name="1-4-answer">
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="field is-hidden" id="2-q">
                    <div class="field">
                        <label class="label">Second Question</label>
                        <div class="control">
                            <input type="text" placeholder="Insert the second question" class="input is-primary" name="2-question">
                        </div>
                        <p class="help">The first answer is the right one</p>
                    </div>

                    <div class="field is-horizontal">
                        <div class="field-body">
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="First answer" name="2-1-answer">
                                </p>
                            </div>
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="Second answer" name="2-2-answer">
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="field is-horizontal">
                        <div class="field-body">
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="Third answer" name="2-3-answer">
                                </p>
                            </div>
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="Fourth answer" name="2-4-answer">
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="field is-hidden" id="3-q">
                    <div class="field">
                        <label class="label">Third Question</label>
                        <div class="control">
                            <input type="text" placeholder="Insert the third question" class="input is-primary" name="3-question">
                        </div>
                        <p class="help">The first answer is the right one</p>
                    </div>


                    <div class="field is-horizontal">
                        <div class="field-body">
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="First answer" name="3-1-answer">
                                </p>
                            </div>
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="Second answer" name="3-2-answer">
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="field is-horizontal">
                        <div class="field-body">
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="Third answer" name="3-3-answer">
                                </p>
                            </div>
                            <div class="field">
                                <p class="control is-expanded">
                                <input class="input is-warning" type="text" placeholder="Fourth answer" name="3-4-answer">
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="field">
                    <div class="control">
                        <button class="button is-light is-info" id="b">
                            <span class="icon">
                              <i class="fas fa-plus"></i>
                            </span>
                            <span>Add a question</span>
                        </button>                       
                    </div>
                </div>
                <div class="field">
                    <p class="control">
                        <button class="button is-primary" id="upload" type="submit" >Upload</button>
                    </p>
                </div>
                <script>
                    var c=1;
                    document.getElementById("b").addEventListener("click", question)
                    function question(event){
                        event.preventDefault()
                        if(c<4){
                            q = document.getElementById(c +"-q")
                            q.classList.remove("is-hidden");
                            c=c+1; 
                        }
                        if(c==4){
                            const b = document.getElementById("b")
                            b.disabled=true;
                        }           
                    }    


                    document.getElementById('thesis').addEventListener("keyup", function(evt) {
                        if (validateThesis(this.value)) {
                            this.classList.remove("is-danger")
                            this.classList.add("is-success")
                            document.getElementById("upload").disabled=false;
                        } else {
                            document.getElementById("upload").disabled=true;
                            this.classList.add("is-danger")
                        }
                    }, false);

                    function validateThesis(thesis) {
                        const re = /^[a-zA-ZàáâäãåąčćęèéêëėįìíîïłńòóôöõøùúûüųūÿýżźñçčšžÀÁÂÄÃÅĄĆČĖĘÈÉÊËÌÍÎÏĮŁŃÒÓÔÖÕØÙÚÛÜŲŪŸÝŻŹÑßÇŒÆČŠŽ∂ð ,.'-]+$/u;
                        return re.test(thesis);
                    }
                </script>
                
                </form>
            </div>
        </div>
    </div>
    {{ template "simplemde" .}}
    {{ template "footer" }}
{{ end }}
